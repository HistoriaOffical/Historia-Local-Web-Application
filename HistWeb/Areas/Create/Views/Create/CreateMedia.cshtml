@using HistWeb.Helpers
@{
    ViewData["Title"] = "Create Builder";
}
<form id="formStep1" class="" novalidate enctype="multipart/form-data">
    <div class="card" style="margin-bottom:10px" id="step1Card">
        <div class="card-body">
            <div class="row" style="max-width:1500px">
                <div class="col-2">
                    <h2 id="type"></h2>
                </div>
                <div class="col-10 text-right">
                    <h4>Current Cycle Ends: <label id="EndCycleDate"></label></h4>
                    <label><small>Don't know where to start? Read <a asp-area="" asp-controller="Home" asp-action="HowTo" style="text-decoration: underline">here</a>.</small></label>
                </div>
            </div>
            <div class="card">
                <div class="card-body border border-info btn-secondary rounded">
                    <div class="row">
                        <div class="col-3">
                            <b>Next Payment Date in: <label id="daysToSuperBlock">Loading...</label> days</b>
                        </div>
                        <div class="col-3">
                            <b>Voting Deadling in: <label id="votingDeadline">Loading...</label> days</b>
                        </div>
                        <div class="col-3">
                            <b>Currently Passing: <label id="totalPassingCoins">Loading...</label> HTA</b>
                        </div>
                        <div class="col-3">
                            <b>Total Available Budget: <label id="totalCoins">Loading...</label></b>
                        </div>
                    </div>
                </div>
            </div>
            <hr />

            <div class="row" style="max-width:1500px">
                <div class="col-3 createuppertab">
                    <label class="col-form-label" for="tbName">Name: <span style="color:#f00">*</span> <span id="tbNameCnt">0</span>/40</label>
                    <input class="form-control" id="tbName" type="text" placeholder="" required maxlength="40" onchange="validateName(); updateCardTitle();" />
                </div>
                <div class="col-3 createuppertab">
                    <label class="col-form-label" for="tbSummary">Summary: <span style="color:#f00">*</span>  <span id="tbSummaryCnt">0</span>/150 </label>
                    <input class="form-control" id="tbSummary" type="text" placeholder="" required maxlength="150" onchange="validateSummary(); updateCardText();" />
                </div>
                <div class="col-3 createuppertab">
                    <label class="col-form-label" for="tbAddress">Autogenerated Reward Address: <span style="color:#f00">*</span> </label>
                    <input class="form-control" id="tbAddress" type="text" placeholder="" onchange="" required maxlength="255" disabled />
                </div>
                <div class="col-3 createuppertab">
                    <label class="col-form-label" for="tbReward">Reward Amount Requested: <span style="color:#f00">*</span> </label>
                    <input class="form-control" id="tbReward" type="text" placeholder="" onchange="validatePaymentAmount();" required maxlength="10" />
                </div>
            </div>
            <div class="row" id="parentid" style="max-width:1500px; display:none;">
                <div class="col-12 createuppertab">
                    <label class="col-form-label" for="tbParentIPFSCID">In response to: <span style="" id="tbParentIPFSCID"><u><a href="" style="color: white;"></a></u></span> </label>
                    <input type="hidden" id="tbParentIPFSCIDhidden" value="" />
                </div>
            </div>

            <div class="row" style="max-width:1500px">
                <div class="card-body">
                    <div id="preview">
                        <div class="row">
                            <div class="col-12"><h4>Preview:</h4></div>
                        </div>
                        <hr />
                    </div>
                </div>
                <div id="archiveDiv" style="width:100%; height:100%; margin-left:30px;">
                    <a title="Historia Network" href="https://historia.network" target="_blank" style="display: inline-block; padding: 5px; margin-left: 10px; min-height: 50px; min-width: 50px;"><img style="color: black; width: 175px;" src="data:image/png;base64,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" /></a>
                    <br />

                    <div id="video" style="display: none; max-width: 512px;"></div>
                    <div id="audio" style="display: none; max-width: 512px;"></div>
                    <div id="image" style="display: none; max-width: 512px;"></div>
                    <div id="document" style="display: none; width: 100%; height: 800px; "></div>
                    <div id="myModal" class="modal"><img id="modalImg" /></div>
                </div>
                <input class="form-control" id="oglinkid" type="hidden" value="" />
            </div>
            <div class="row" style="max-width:1500px">
                <div class="card-body">
                    <div class="row" style="max-width:1500px">
                        <div class="col-6">
                            <label>Total Size:&nbsp;<label id="totalSize">0</label>&nbsp;MB</label>
                        </div>
                    </div>
                    <hr />
                    <div class="row" style="max-width:1500px">
                        <div class="col-6">
                            <button name="saveDraft" id="saveDraft" class="btn btn-secondary float-left mr-1">Save Draft</button> &nbsp;
                            <button name="deleteDraft" id="deleteDraft" class="btn btn-secondary float-left">Delete Draft</button>
                            <button name="deleteArchiveDraft" id="deleteArchiveDraft" class="btn btn-secondary float-left">Delete Draft</button>
                        </div>
                        <div class="col-6">
                            <button name="submitArchive" id="submitArchive" class="btn btn-secondary float-right" disabled style="display: none;">Submit Media</button>&nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
<div class="row">
    &nbsp;
</div>
<div class="row">
    &nbsp;
</div>
<div class="row">
    &nbsp;
</div>

@section Scripts {
    <script src="~/lib/qrcode/qrcode.min.js"></script>
    <link rel="stylesheet" href="~/lib/fontawesome/css/all.min.css" />

    <script type="text/javascript">
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Enter') {
                event.preventDefault();
            }
        });
        function updateCardText() {
            const tbSummary = document.getElementById('tbSummary');
            const cardText = document.querySelector('.card-text');
            cardText.textContent = tbSummary.value;
        }
        document.getElementById('tbSummary').addEventListener('input', updateCardText);

        function updateCardTitle() {
            const tbName = document.getElementById('tbName');
            const cardTitleElement = document.querySelector('.card-title');
            cardTitleElement.textContent = tbName.value;
        }
        document.getElementById('tbName').addEventListener('input', updateCardTitle);

        let timerInterval;
        var LandingPage = {
            html: null,
            css: null,
            components: null,
            style: null,
        };
        var editor = {};

        let searchParams = new URLSearchParams(window.location.search)
        var id = searchParams.get('Id');
        var type = searchParams.get('Type');
        var template = searchParams.get('Template');
        var archiveURL = searchParams.get('ArchiveURL');
        var cidtype = searchParams.get('cidtype');
        var pid = searchParams.get('pid');
        var ipfsurl = searchParams.get('ipfsurl');

        var filename = searchParams.get('filename');
        if (type == 1) {
            $('#type').text("Proposal");
            $('#submitRec').show();
        } else if (type == 4) {
            $('#type').text("Record");
            $('#submitRec').show();
        } else if (type == 4.1) {
            $('#type').text("Media");
            $('#submitRec').show();
        } else if (type == 5) {
            $('#type').text("Archive");
            $('#tutorial').hide();
            $('#submitRec').hide();

        }

        function validatePaymentAmount() {

            if (/\d/.test($('#tbReward').val())) {

            } else {
                Swal.fire({
                    title: 'Error!',
                    text: 'Reward Amount is not a number.',
                    type: 'error',
                    confirmButtonColor: "#48B5C4",
                    confirmButtonText: 'Ok'
                });
            }

            if ($('#tbReward').val() > $('#totalCoins').text()) {
                Swal.fire({
                    title: 'Error!',
                    text: 'Reward Amount is more than total available budget.',
                    type: 'error',
                    confirmButtonColor: "#48B5C4",
                    confirmButtonText: 'Ok'
                });
            }
            if ($('#tbReward').val() > ($('#totalCoins').text() - $('#totalPassingCoins').text())   ) {
                Swal.fire({
                    title: 'Error!',
                    text: 'Reward Amount is more that available budget. (Reward Amount Requested > (Total Available Budget - Currently Passing))',
                    type: 'error',
                    confirmButtonColor: "#48B5C4",
                    confirmButtonText: 'Ok'
                });
            }
        }

        function validateAddress() {
            var dfrdResponse = $.Deferred();
            var data = new FormData(document.getElementById('formStep1'));
            data.append('rewardPaymentAddress', $('#tbAddress').val());
            $.ajax({
                url: '@Url.Action("ValidateAddress", "Create", new { Area = "Create" })',
                type: 'POST',
                contentType: false,
                processData: false,
                data: data
            }).done(function (result) {
               dfrdResponse.resolve(result);
            });
            return dfrdResponse.promise();
        }

        function validatePaymentAddress() {
            validateAddress().then((result) => {
                if (result) {

                }
                else {
                    Swal.fire({
                        title: 'Invalid address',
                        text: 'Payment Address is not valid.',
                        type: 'error',
                        confirmButtonColor: "#545B62",
                        confirmButtonText: 'Ok'
                    });
                }
            });
        }

        function GetNewAddress() {

            $.getJSON('@Url.Action("GetNewAddressGet", "Masternode", new { area = "Masternode" })', function (result) {
                //console.log("JSON: " + JSON.stringify(result));
            }).done(function (result) {

                if (result.success) {
                    $('#tbAddress').val(result.address);
                }

            }).fail(function (jqXHR, textStatus, errorThrown) {
                console.log("error: " + textStatus + ", " + errorThrown + ", " + jqXHR);
            });
        }

        function checkPaymentAddress() {
            var allowed_characters = "123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";

            // Get the value directly from the input field
            var inputValue = $('#tbAddress').val();

            // Check if each character in inputValue is allowed
            for (var i = 0; i < inputValue.length; i++) {
                if (allowed_characters.indexOf(inputValue[i]) === -1) {
                    Swal.fire({
                        title: 'Invalid character',
                        text: "Allowed characters are: 123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",
                        type: 'error',
                        confirmButtonColor: "#545B62",
                        confirmButtonText: 'Ok'
                    });
                    // Optionally,
                    return;
                }
            }
        }


        function validateName() {
            var allowed_characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0912345678 .,;-_/:?()'\"";

            // Get the value directly from the input field
            var inputValue = $("#tbName").val();

            // Check if each character in inputValue is allowed
            for (var i = 0; i < inputValue.length; i++) {
                if (allowed_characters.indexOf(inputValue[i]) === -1) {
                    Swal.fire({
                        title: 'Invalid character',
                        text: "Allowed characters are: ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0912345678 .,;-_/:?()'\"",
                        type: 'error',
                        confirmButtonColor: "#545B62",
                        confirmButtonText: 'Ok'
                    });
                    // Optionally,
                    return;
                }
            }

        }

        function validateSummary() {
            var allowed_characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0912345678 .,;-_/:?()'\"";

            // Get the value directly from the input field
            var inputValue = $("#tbSummary").val();

            // Check if each character in inputValue is allowed
            for (var i = 0; i < inputValue.length; i++) {
                if (allowed_characters.indexOf(inputValue[i]) === -1) {
                    // Character not allowed, handle accordingly (e.g., show an alert)
                    Swal.fire({
                        title: 'Invalid character',
                        text: "Allowed characters are: ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0912345678 .,;-_/:?()'\"",
                        type: 'error',
                        confirmButtonColor: "#545B62",
                        confirmButtonText: 'Ok'
                    });
                    return;
                }
            }

        }

        function UpdateProposalNameCnt() {
            var cs = $(this).val().length;
            $('#tbNameCnt').text(cs);
        }

        function UpdateProposalSummaryCnt() {
            var cs = $(this).val().length;
            $('#tbSummaryCnt').text(cs);
        }

        function UpdateGrapeCnt() {
            var html = editor.getHtml();
            var css = editor.getCss();
            var size = parseFloat((html.length + css.length) / 1000000).toFixed(2);
            $('#totalSize').text(size);
            return size;
        }

        function CreateBuilderLoad() {


            $.getJSON('@Url.Action("CreateBuilderLoad", "Create", new { area = "Create" })', { id: id }, function (result) {

            }).done(function (result) {


                if (result.id == 0) {
                    grapesjs.plugins.add('tweet-plugin', (editor, options) => {
                        editor.BlockManager.add('tweet-block', {
                            label: 'Import Tweet',
                            category: 'Social',
                            content: '<div data-gjs-type="tweet-block"></div>',
                            attributes: { class: 'fab fa-twitter' },
                            onClick: function () {
                                Swal.fire({
                                    title: "Import Post (Tweet).",
                                    text: "Drag this on to the canvas to use.",
                                    showCancelButton: false,
                                    confirmButtonText: 'OK',
                                    confirmButtonColor: "#48B5C4",

                                });
                            },
                        });

                        // Define the component type 'tweet-block'
                        editor.DomComponents.addType('tweet-block', {
                            model: {
                                defaults: {
                                    tagName: 'div',
                                    classes: ['tweet-block'],
                                },
                            },
                        });

                        // Handle the drop event when the tweet block is dropped onto the canvas
                        editor.on('block:drag:stop', (block) => {
                            if (block.get('type') === 'tweet-block') {
                                // Open a SweetAlert dialog for the user to enter the tweet URL
                                Swal.fire({
                                    title: 'Enter the Post (Tweet) URL:',
                                    text: "This is an expertimental feature. It will not import 'Extended' Posts (Tweets) URL. If it doesn't work properly, you can always just do this process manually via taking a screen shot of the Post (Tweet) and importing it as an image .",
                                    input: 'text',
                                    showCancelButton: true,
                                    confirmButtonText: 'Submit',
                                    confirmButtonColor: "#48B5C4",
                                    showLoaderOnConfirm: true,
                                    preConfirm: (tweetUrl) => {
                                        if (tweetUrl) {
                                            // Send the tweet URL to your C# function via AJAX
                                            sendTweetUrlToCsharp(tweetUrl);
                                        }
                                    }
                                });
                            }
                        });

                        function sendTweetUrlToCsharp(tweetUrl) {
                            // Show the "Processing... Please wait" message
                            Swal.fire({
                                title: "Processing...",
                                text: "Attempting to import the Post (Tweet) screenshot",
                                showConfirmButton: false,
                                allowOutsideClick: false,
                                didOpen: () => {
                                    Swal.showLoading();
                                }
                            });

                            // Perform an AJAX request to your C# function
                            $.getJSON('@Url.Action("ImportTweet", "Create", new { area = "Create" })', { tweetUrl: tweetUrl })
                                .done(function(result) {
                                    // Hide the "Processing... Please wait" message
                                    Swal.close();

                                    if (result.success === false) {
                                        // Handle error case
                                        Swal.fire({
                                            icon: "error",
                                            title: "Error",
                                            confirmButtonColor: "#48B5C4",
                                            text: "Failed to import the Post (Tweet). Please try again later."
                                        });
                                    } else {
                                        const tweetContents = JSON.parse(result);
                                        insertTweetContents(tweetContents, tweetUrl);
                                    }
                                })
                                .fail(function(jqXHR, textStatus, errorThrown) {
                                    console.log("error: " + textStatus + ", " + errorThrown + ", " + jqXHR);
                                    Swal.close();
                                    Swal.fire({
                                        icon: "error",
                                        title: "Error",
                                        confirmButtonColor: "#48B5C4",
                                        text: "Failed to import the Post (Tweet). Please try again later."
                                    });
                                });
                        }

                        // Function to insert the tweet contents into the GrapeJS editor
                        function insertTweetContents(tweetImage, tweetUrl) {
                            const imageComponent = editor.DomComponents.addComponent({
                                tagName: 'img',
                                attributes: {
                                    src: `data:image/png;base64, ${tweetImage}`,
                                    style: 'border: 1px solid black;', // Add a border to the image
                                },
                            });

                            const linkComponent = editor.DomComponents.addComponent({
                                tagName: 'a',
                                attributes: {
                                    href: tweetUrl,
                                    target: '_blank',
                                },
                                components: [imageComponent], // Set the image component as a child of the link component
                            });

                            // Append the image component to the canvas
                            editor.getWrapper().appendChild(linkComponent);

                            // Refresh the editor to update the view
                            editor.refresh();
                        }
                    });

                    editor = grapesjs.init({
                        blocks: true,
                        container: '#gjs',
                        plugins: ['gjs-preset-webpage', 'tweet-plugin'],
                        pluginsOpts: {
                            'gjs-preset-webpage': {
                                // options for the 'gjs-preset-webpage' plugin
                            },
                            'tweet-plugin': {
                                // options for the 'tweet-plugin' plugin
                            },
                        },
                        fromElement: false,
                        storageManager: {
                            autoload: false,
                        },
                    });
                    return false;
                } else {

                      grapesjs.plugins.add('tweet-plugin', (editor, options) => {
                        editor.BlockManager.add('tweet-block', {
                            label: 'Import Tweet',
                            category: 'Social',
                            content: '<div data-gjs-type="tweet-block"></div>',
                            attributes: { class: 'fab fa-twitter' },
                            onClick: function () {
                                Swal.fire({
                                    title: "Import Post (Tweet).",
                                    text: "Drag this on to the canvas to use.",
                                    showCancelButton: false,
                                    confirmButtonText: 'OK',
                                    confirmButtonColor: "#48B5C4",

                                });
                            },
                        });

                        // Define the component type 'tweet-block'
                        editor.DomComponents.addType('tweet-block', {
                            model: {
                                defaults: {
                                    tagName: 'div',
                                    classes: ['tweet-block'],
                                },
                            },
                        });

                        // Handle the drop event when the tweet block is dropped onto the canvas
                        editor.on('block:drag:stop', (block) => {
                            if (block.get('type') === 'tweet-block') {
                                // Open a SweetAlert dialog for the user to enter the tweet URL
                                Swal.fire({
                                    title: 'Enter the Post (Tweet) URL:',
                                    text: "This is an expertimental feature. It will not import 'Extended' Posts (Tweets) URL. If it doesn't work properly, you can always just do this process manually via taking a screen shot of the Post (Tweet) and importing it as an image .",
                                    input: 'text',
                                    showCancelButton: true,
                                    confirmButtonText: 'Submit',
                                    confirmButtonColor: "#48B5C4",
                                    showLoaderOnConfirm: true,
                                    preConfirm: (tweetUrl) => {
                                        if (tweetUrl) {
                                            // Send the tweet URL to your C# function via AJAX
                                            sendTweetUrlToCsharp(tweetUrl);
                                        }
                                    }
                                });
                            }
                        });

                        function sendTweetUrlToCsharp(tweetUrl) {
                            // Show the "Processing... Please wait" message
                            Swal.fire({
                                title: "Processing...",
                                text: "Attempting to import the Post (Tweet) screenshot",
                                showConfirmButton: false,
                                allowOutsideClick: false,
                                didOpen: () => {
                                    Swal.showLoading();
                                }
                            });

                            // Perform an AJAX request to your C# function
                            $.getJSON('@Url.Action("ImportTweet", "Create", new { area = "Create" })', { tweetUrl: tweetUrl })
                                .done(function(result) {
                                    // Hide the "Processing... Please wait" message
                                    Swal.close();

                                    if (result.success === false) {
                                        // Handle error case
                                        Swal.fire({
                                            icon: "error",
                                            title: "Error",
                                            confirmButtonColor: "#48B5C4",
                                            text: "Failed to import the Post (Tweet). Please try again later."
                                        });
                                    } else {
                                        const tweetContents = JSON.parse(result);
                                        insertTweetContents(tweetContents, tweetUrl);
                                    }
                                })
                                .fail(function(jqXHR, textStatus, errorThrown) {
                                    console.log("error: " + textStatus + ", " + errorThrown + ", " + jqXHR);
                                    Swal.close();
                                    Swal.fire({
                                        icon: "error",
                                        title: "Error",
                                        confirmButtonColor: "#48B5C4",
                                        text: "Failed to import the Post (Tweet). Please try again later."
                                    });
                                });
                        }

                        // Function to insert the tweet contents into the GrapeJS editor
                        function insertTweetContents(tweetImage, tweetUrl) {
                            const imageComponent = editor.DomComponents.addComponent({
                                tagName: 'img',
                                attributes: {
                                    src: `data:image/png;base64, ${tweetImage}`,
                                    style: 'border: 1px solid black;', // Add a border to the image
                                },
                            });

                            const linkComponent = editor.DomComponents.addComponent({
                                tagName: 'a',
                                attributes: {
                                    href: tweetUrl,
                                    target: '_blank',
                                },
                                components: [imageComponent], // Set the image component as a child of the link component
                            });

                            // Append the image component to the canvas
                            editor.getWrapper().appendChild(linkComponent);

                            // Refresh the editor to update the view
                            editor.refresh();
                        }
                    });

                    editor = grapesjs.init({
                        blocks: true,
                        container: '#gjs',
                        plugins: ['gjs-preset-webpage', 'tweet-plugin'],
                        pluginsOpts: {
                            'gjs-preset-webpage': {
                                // options for the 'gjs-preset-webpage' plugin
                            },
                            'tweet-plugin': {
                                // options for the 'tweet-plugin' plugin
                            },
                        },
                        fromElement: false,
                        storageManager: {
                            autoload: false,
                        },
                    });

                    LandingPage = {
                        html: result[0].html,
                        css: result[0].css,
                        components: null,
                        style: null,
                    };

                    editor = grapesjs.init({
                        blocks: true,
                        container: '#gjs',
                        plugins: ['gjs-preset-webpage'],
                        pluginsOpts: {
                            pluginsOpts: {
                                'gjs-preset-webpage': {
                                    // options for the 'gjs-preset-webpage' plugin
                                },
                                'tweet-plugin': {
                                    // options for the 'tweet-plugin' plugin
                                },
                            },
                        },

                        fromElement: false,
                        components: LandingPage.html,
                        style: LandingPage.css,
                        storageManager: {
                            autoload: false
                        },

                    });



                    $('#tbName').val(result[0].name);
                    $('#tbSummary').val(result[0].summary);

                    $('#tbAddress').val(result[0].paymentAddress);
                    $('#tbReward').val(result[0].paymentAmount);
                    //$('#tbIsDraft').val(result[0].IsDraft);
                    $('#tbPaymentDate').val("Today");

                    return false;
                }

            }).fail(function (jqXHR, textStatus, errorThrown) {
				console.log("error: " + textStatus + ", " + errorThrown + ", " + jqXHR);
            });
        }

        function PollForPayment(Address, uid) {
            var dfrdResponse = $.Deferred();
            $.getJSON('@Url.Action("PollForPayment", "Create", new { area = "Create" })', { Address: Address, uid: uid }, function (result) {

            }).done(function (result) {
                dfrdResponse.resolve(result.success);


            }).fail(function (jqXHR, textStatus, errorThrown) {
                console.log("error: " + textStatus + ", " + errorThrown + ", " + jqXHR);
                return false;
            });
            return dfrdResponse.promise();

        }

        function SubscriberCheck() {
            var dfrdResponse = $.Deferred();
           $.getJSON('@Url.Action("IsSubscribed", "Subscription", new { Area = "Subscription" })', function (result) {

           }).done(function (result) {

                dfrdResponse.resolve(result.submissions);
            })
            return dfrdResponse.promise();
        }

        function CreateBuilderLoadTemplate(template, id) {
            $.getJSON('@Url.Action("CreateBuilderLoadTemplate", "Create", new { area = "Create" })', { id: 0, template: template }, function (result) {


            }).done(function (result) {
                 grapesjs.plugins.add('tweet-plugin', (editor, options) => {
                        editor.BlockManager.add('tweet-block', {
                            label: 'Import Tweet',
                            category: 'Social',
                            content: '<div data-gjs-type="tweet-block"></div>',
                            attributes: { class: 'fab fa-twitter' },
                            onClick: function () {
                                Swal.fire({
                                    title: "Import Post (Tweet).",
                                    text: "Drag this on to the canvas to use.",
                                    showCancelButton: false,
                                    confirmButtonText: 'OK',
                                    confirmButtonColor: "#48B5C4",

                                });
                            },
                        });

                        // Define the component type 'tweet-block'
                        editor.DomComponents.addType('tweet-block', {
                            model: {
                                defaults: {
                                    tagName: 'div',
                                    classes: ['tweet-block'],
                                },
                            },
                        });

                        // Handle the drop event when the tweet block is dropped onto the canvas
                        editor.on('block:drag:stop', (block) => {
                            if (block.get('type') === 'tweet-block') {
                                // Open a SweetAlert dialog for the user to enter the tweet URL
                                Swal.fire({
                                    title: 'Enter the Post (Tweet) URL:',
                                    text: "This is an expertimental feature. It will not import 'Extended' Posts (Tweets) URL. If it doesn't work properly, you can always just do this process manually via taking a screen shot of the Post (Tweet) and importing it as an image .",
                                    input: 'text',
                                    showCancelButton: true,
                                    confirmButtonText: 'Submit',
                                    confirmButtonColor: "#48B5C4",
                                    showLoaderOnConfirm: true,
                                    preConfirm: (tweetUrl) => {
                                        if (tweetUrl) {
                                            // Send the tweet URL to your C# function via AJAX
                                            sendTweetUrlToCsharp(tweetUrl);
                                        }
                                    }
                                });
                            }
                        });

                        function sendTweetUrlToCsharp(tweetUrl) {
                            // Show the "Processing... Please wait" message
                            Swal.fire({
                                title: "Processing...",
                                text: "Attempting to import the Post (Tweet) screenshot",
                                showConfirmButton: false,
                                allowOutsideClick: false,
                                didOpen: () => {
                                    Swal.showLoading();
                                }
                            });

                            // Perform an AJAX request to your C# function
                            $.getJSON('@Url.Action("ImportTweet", "Create", new { area = "Create" })', { tweetUrl: tweetUrl })
                                .done(function(result) {
                                    // Hide the "Processing... Please wait" message
                                    Swal.close();

                                    if (result.success === false) {
                                        // Handle error case
                                        Swal.fire({
                                            icon: "error",
                                            title: "Error",
                                            confirmButtonColor: "#48B5C4",
                                            text: "Failed to import the Post (Tweet). Please try again later."
                                        });
                                    } else {
                                        const tweetContents = JSON.parse(result);
                                        insertTweetContents(tweetContents, tweetUrl);
                                    }
                                })
                                .fail(function(jqXHR, textStatus, errorThrown) {
                                    console.log("error: " + textStatus + ", " + errorThrown + ", " + jqXHR);
                                    Swal.close();
                                    Swal.fire({
                                        icon: "error",
                                        title: "Error",
                                        confirmButtonColor: "#48B5C4",
                                        text: "Failed to import the Post (Tweet). Please try again later."
                                    });
                                });
                        }

                        // Function to insert the tweet contents into the GrapeJS editor
                        function insertTweetContents(tweetImage, tweetUrl) {
                            const imageComponent = editor.DomComponents.addComponent({
                                tagName: 'img',
                                attributes: {
                                    src: `data:image/png;base64, ${tweetImage}`,
                                    style: 'border: 1px solid black;', // Add a border to the image
                                },
                            });

                            const linkComponent = editor.DomComponents.addComponent({
                                tagName: 'a',
                                attributes: {
                                    href: tweetUrl,
                                    target: '_blank',
                                },
                                components: [imageComponent], // Set the image component as a child of the link component
                            });

                            // Append the image component to the canvas
                            editor.getWrapper().appendChild(linkComponent);

                            // Refresh the editor to update the view
                            editor.refresh();
                        }
                    });


                LandingPage = {
                    html: result[0].html,
                    css: result[0].css,
                    components: null,
                    style: null,
                };

                editor = grapesjs.init({
                    blocks: true,
                    container: '#gjs',
                    plugins: ['gjs-preset-webpage', 'tweet-plugin'],
                    pluginsOpts: {
                        'gjs-preset-webpage': {
                            // options
                        },
                        'tweet-plugin': {
                            // options for the 'tweet-plugin' plugin
                        },
                    },
                    fromElement: false,
                    components: LandingPage.html,
                    style: LandingPage.css,
                    storageManager: {
                        autoload: false
                    },
                });
                size = UpdateGrapeCnt();
            }).fail(function (jqXHR, textStatus, errorThrown) {
				console.log("error: " + textStatus + ", " + errorThrown + ", " + jqXHR);
            });
        }

        function convertBytesToMegabytes(bytes) {
            const megabytes = bytes / (1024 * 1024);
            return Number(megabytes.toFixed(2));
        }

        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }


        function CreateBuilderLoadMedia() {
            var ext;
            ext = 1;
            let searchParams = new URLSearchParams(window.location.search)
            var filename = searchParams.get('filename');
            if (ext == 1) {

                if (filename) {
                    $.ajax({
                        url: '@Url.Action("GetUploadedMedia", "Create", new { Area = "Create" })?filename=' + filename,
                        type: 'GET',
                        contentType: false,
                        processData: false,
                        success: function (response) {
                            const url = "/media/" + filename;
                            const ft = response.filetype;
                            displayBase64Content(response.base64, ft, filename);
                            GetParentInfo();
                        },

                    });
                }

            }
        }

        let parentName = "";
        let parentSummary = "";
        function GetParentInfo() {
            var ext;
            ext = 1;
            let searchParams = new URLSearchParams(window.location.search)
            var pid = searchParams.get('pid');
            if (ext == 1) {

                if (filename) {
                    $.ajax({
                        url: '@Url.Action("GetParentInfo", "Create", new { Area = "Create" })?pid=' + pid,
                        type: 'GET',
                        contentType: false,
                        processData: false,
                        success: function (response) {
                            parentName = response.parentname;
                            parentSummary = response.parentsummary;
                            if (pid !== null && pid !== undefined && pid !== "") {
                                $('#parentid').show();
                                $('#tbParentIPFSCID').html("<u><a href=/Proposals/Proposals/ProposalDetails?hash=" + pid + " style='color: white;'>" + parentName + "-" + parentSummary + "</a></u>");
                                $('#tbParentIPFSCIDhidden').val(ipfsurl);
                            }
                        },

                    });
                }

            }
        }

        function displayBase64Content(base64Content, fileType, filename) {
            try {
                var ft;
                switch (fileType) {
                    case 'image':
                        $('#image').show();
                        ft = "image";
                        break;
                    case 'video':
                        $('#video').show();
                        ft = "video";
                        break;
                    case 'pdf':
                        $('#document').show();
                        ft = "document";
                        break;
                    case 'audio':
                        $('#audio').show();
                        ft = "audio";
                        break;
                    default:

                }

                const archiveDiv = document.getElementById(ft);

                if (archiveDiv) {

                    displayFileContent(archiveDiv, base64Content, filename, fileType);
                } else {
                    console.error('Element with id "archiveDiv" not found.');
                }
            } catch (error) {
                console.error('Error parsing stored file data:', error);
            }

        }

        function displayFileContent(container, base64Content, fileName, fileType) {
            try {
                var cardBodyElement;
                var cardTitleElement;
                var cardText;
                var cardElement;
                var dateElement;
                var currentDate;
                    switch (fileType) {
                        case 'image':
                            $('#tbName').val('What is the title?');
                            $('#tbSummary').val('Describe the image.');
                            dateElement = document.createElement('p');
                            dateElement.classList.add('card-date');
                            currentDate = new Date().toUTCString();
                            dateElement.textContent = currentDate;
                            dateElement.style.fontSize = '0.8rem';

                            dateElement.style.color = '#a6a6a6';
                            cardBodyElement = document.createElement('div');
                            cardTitleElement = document.createElement('h5');
                            cardText = document.createElement('p');
                            cardElement = document.createElement('div');
                            cardElement.classList.add('card', 'mb-3');

                            cardElement.style.marginLeft = '10px';
                            const imgElement = document.createElement('img');
                            imgElement.src = 'data:image/png;base64,' + base64Content;
                            imgElement.classList.add('card-img-top', 'img-fluid', 'rounded');
                            imgElement.setAttribute('onclick', 'openModal(this)');

                            cardBodyElement.classList.add('card-body');
                            cardTitleElement.classList.add('card-title');

                            cardTitleElement.textContent = 'What is the title?';
                            cardTitleElement.id = 'image-title';
                            cardText.classList.add('card-text');
                            cardText.id = 'image-text';
                            cardText.textContent = 'Describe the image.';
                            cardBodyElement.appendChild(cardTitleElement);
                            cardBodyElement.appendChild(cardText);
                            cardBodyElement.appendChild(dateElement);
                            cardElement.appendChild(cardBodyElement);
                            cardElement.appendChild(imgElement);
                            container.appendChild(cardElement);
                            //var totalSizeInBytes = calculateSizeInBytes(container);
                            //var size = convertBytesToMegabytes(totalSizeInBytes);
                            var size = parseFloat($('#archiveDiv').html().length / 1000000).toFixed(2);
                            $("#totalSize").html(size);
                            break;
                        case 'video':
                            $('#tbName').val('What is the title?');
                            $('#tbSummary').val('Describe the video.');
                            dateElement = document.createElement('p');
                            dateElement.classList.add('card-date');
                            currentDate = new Date().toUTCString();
                            dateElement.textContent = currentDate;
                            dateElement.style.fontSize = '0.8rem';
                            dateElement.style.color = '#a6a6a6';

                            cardBodyElement = document.createElement('div');
                            cardTitleElement = document.createElement('h5');
                            cardText = document.createElement('p');
                            cardElement = document.createElement('div');
                            cardElement.classList.add('card', 'mb-3');
                            cardElement.style.marginLeft = '10px';
                            const videoElement = document.createElement('video');
                            videoElement.controls = true;
                            videoElement.src = 'data:video/mp4;base64,' + base64Content;
                            videoElement.classList.add('card-img-top', 'img-fluid', 'rounded');

                            cardBodyElement.classList.add('card-body');
                            cardTitleElement.classList.add('card-title');

                            cardTitleElement.id = 'video-title';
                            cardText.classList.add('card-text');
                            cardText.id = 'video-text';
                            cardTitleElement.textContent = 'What is the title?';
                            cardText.textContent = 'Describe the video.';
                            cardBodyElement.appendChild(cardTitleElement);
                            cardBodyElement.appendChild(cardText);
                            cardBodyElement.appendChild(dateElement);
                            cardElement.appendChild(cardBodyElement);
                            cardElement.appendChild(videoElement);
                            container.appendChild(cardElement);
                            //var totalSizeInBytes = calculateSizeInBytes(container);
                            //var size = convertBytesToMegabytes(totalSizeInBytes);
                            var size = parseFloat($('#archiveDiv').html().length / 1000000).toFixed(2);
                            $("#totalSize").html(size);
                            break;
                        case 'pdf':
                            $('#tbName').val('What is the title?');
                            $('#tbSummary').val('Describe the document.');
                            dateElement = document.createElement('p');
                            dateElement.classList.add('card-date');
                            dateElement.style.fontSize = '0.8rem';
                            dateElement.style.color = '#a6a6a6';
                            currentDate = new Date().toUTCString();
                            dateElement.textContent = currentDate;
                            const cardAboveIframeElement = document.createElement('div');
                            cardAboveIframeElement.classList.add('card', 'mb-3');

                            const cardBodyAboveIframeElement = document.createElement('div');
                            cardBodyAboveIframeElement.classList.add('card-body');

                            const cardTitleAboveIframeElement = document.createElement('h5');
                            cardTitleAboveIframeElement.classList.add('card-title');
                            cardTitleAboveIframeElement.textContent = 'What is the title?';

                            const cardTextAboveIframeElement = document.createElement('p');
                            cardTextAboveIframeElement.classList.add('card-text');
                            cardTextAboveIframeElement.textContent = 'Describe the document.';


                            cardBodyAboveIframeElement.appendChild(cardTitleAboveIframeElement);
                            cardBodyAboveIframeElement.appendChild(cardTextAboveIframeElement);
                            cardBodyAboveIframeElement.appendChild(dateElement);
                            cardAboveIframeElement.appendChild(cardBodyAboveIframeElement);

                            $('#archiveDiv').append(cardAboveIframeElement);

                            const iframeElement = document.createElement('iframe');
                            iframeElement.src = 'data:application/pdf;base64,' + base64Content;
                            iframeElement.width = '100%';
                            iframeElement.height = '800px';
                            iframeElement.classList.add('card-img-top');

                            container.appendChild(iframeElement);

                            $('#archiveDiv').append(container);

                            //var totalSizeInBytes = calculateSizeInBytes(container);
                            //var size = convertBytesToMegabytes(totalSizeInBytes);
                            var size = parseFloat($('#archiveDiv').html().length / 1000000).toFixed(2);
                            $("#totalSize").html(size);
                            break;
                        case 'audio':
                            $('#tbName').val('This is the title.');
                            $('#tbSummary').val('Describe the audio.');
                            dateElement = document.createElement('p');
                            dateElement.classList.add('card-date');

                            dateElement.style.fontSize = '0.8rem';
                            dateElement.style.color = '#a6a6a6';;
                            currentDate = new Date().toUTCString();
                            dateElement.textContent = currentDate;
                            cardBodyElement = document.createElement('div');
                            cardTitleElement = document.createElement('h5');
                            cardText = document.createElement('p');
                            cardElement = document.createElement('div');

                            cardElement.classList.add('card', 'mb-3');
                            cardElement.style.marginLeft = '10px';
                            const audioElement = document.createElement('audio');
                            audioElement.controls = true;
                            audioElement.src = 'data:audio/mp3;base64,' + base64Content;
                            audioElement.classList.add('card-img-top', 'rounded', 'mb-3');

                            cardBodyElement.classList.add('card-body');
                            cardTitleElement.classList.add('card-title');
                            cardTitleElement.id = 'audio-title';
                            cardText.classList.add('card-text');
                            cardText.id = 'audio-text';
                            cardTitleElement.textContent = 'What is the title?';
                            cardText.textContent = 'Describe the audio.';

                            cardBodyElement.appendChild(cardTitleElement);
                            cardBodyElement.appendChild(cardText);
                            cardBodyElement.appendChild(dateElement);
                            cardBodyElement.appendChild(audioElement); // Corrected here, moved audioElement to cardBodyElement
                            cardElement.appendChild(cardBodyElement);

                            container.appendChild(cardElement);

                            //var totalSizeInBytes = calculateSizeInBytes(container);
                            //var size = convertBytesToMegabytes(totalSizeInBytes);
                            var size = parseFloat($('#archiveDiv').html().length / 1000000).toFixed(2);
                            $("#totalSize").html(size);
                            break;
                        default:
                            const unsupportedElement = document.createElement('p');
                            unsupportedElement.textContent = 'Unsupported file type. Cannot display content.';
                            container.appendChild(unsupportedElement);
                            Swal.fire({
                                title: 'Unsupported file type.',
                                html: 'Can not load this media type.',
                                icon: 'error',
                                confirmButtonText: 'OK',
                                allowOutsideClick: false,
                                allowEscapeKey: false,
                                closeOnClickOutside: false,
                                backdrop: true,
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    url = "/Create/Create/";

 
                                    window.location.href = url;
                                }
                            });
                    }

            } catch (error) {
                console.error('Error displaying file content:', error);
            }
        }

        function getFileType(fileData) {
            // Get the file extension from the file name
            const fileName = fileData.fileName;
            const fileExtension = fileName.split('.').pop().toLowerCase();

            // Determine the file type based on the extension
            if (['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension)) {
                return 'image';
            } else if (['mp4', 'webm', 'ogg'].includes(fileExtension)) {
                return 'video';
            } else if (['mp3', 'wav', 'ogg'].includes(fileExtension)) {
                return 'audio';
            } else if (fileExtension === 'pdf') {
                return 'pdf';
            } else {
                return 'unsupported';
            }
        }


        function CreateBuilderLoadArchiveURL() {
            var ext;
            ext = 1;

            if (ext == 1) {

                $.getJSON('@Url.Action("CreateBuilderLoadArchiveURL", "Create", new { area = "Create" })', { id: id }, function (result) {

                }).done(function (result) {

                }).fail(function (jqXHR, textStatus, errorThrown) {
                    console.log("error: " + textStatus + ", " + errorThrown + ", " + jqXHR);
                });

                $.ajax({
                    url: '@Url.Action("PollForArchive", "Create", new { Area = "Create" })?id=' + id,
                    type: 'GET',
                    contentType: false,
                    processData: false,
                    beforeSend: function () {
                        Swal.fire({
                            showConfirmButton: false,
                            allowOutsideClick: false,
                            allowEscapeKey: false,
                            closeOnClickOutside: false,
                            backdrop: true,
                            title: 'Loading Imported Archive',
                            html:
                                'Please wait while we load your archive.',

                            didOpen: () => {
                                const content = Swal.getHtmlContainer()
                                const $ = content.querySelector.bind(content)
                                Swal.showLoading()
                            }
                        })
                    },
                }).done(function (result) {
                    swal.close();
                   // $('#archiveDiv').show();
                    $('#preview').show();
                    //$("#archiveDiv").html(result[0].template);
                    $("#oglinkid").val(result[0].oglinkid);
                    var size = convertBytesToMegabytes(result[0].totalSize);
                    if (size > 20) {
                        Swal.fire({
                            title: 'Error!',
                            text: 'The webpage or file you have created exceeds the maximum size limit of 20MB.',
                            type: 'error',
                            confirmButtonColor: "#48B5C4",
                            confirmButtonText: 'Ok'
                        });
                    }
                    $("#totalSize").html(size);
                });
            }
        }

        function sleep(ms) {
            var start = new Date().getTime();
            for (var i = 0; i < 1e7; i++) {
                if ((new Date().getTime() - start) > ms) {
                    break;
                }
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        $('#submitArchive').off().on('click', function (evt) {
            evt.stopPropagation();
            evt.preventDefault();

            size = parseFloat($('#archiveDiv').html().length / 1000000).toFixed(2);
            if (size > 20) {
                Swal.fire({
                    title: 'Error!',
                    text: 'The web page or file you have created exceeds the maximum size limit of 20MB.',
                    type: 'error',
                    confirmButtonColor: "#545B62",
                    confirmButtonText: 'Ok'
                });
                return false;
            }

            evt.preventDefault();
            evt.stopPropagation();
            var passphrase;
            Swal.fire({
                title: "Are you sure you want to continue?",
                html:
                    '<h5>You can not edit this document after submission!</h5><b>Before submitting we recommend checking the following:</b><br><br><ul><li  style="text-align: left;">Grammar is important - Check the grammar.</li><li style="text-align: left;">Check formatting - Is capitalization correct? Does the submission look professionally written?</li><li  style="text-align: left;">Check content - Are images properly formatted and sized? Are there captions below images?</li><li style="text-align: left;">Name - Did you add an apprioprate name?</li><li style="text-align: left;">Summary - Does your summary do a good job summarizing the article?</li><li style="text-align: left;">Reward Address - Is it correct?</li><li style="text-align: left;">Reward Amount - We recommend at least asking for more than the cost of submission.</li></ul><h5>You must enter your Historia Core wallet passphrase. If your wallet is not encrypted, encrypt your wallet first, otherwise this process will fail.</h5><input type="password" id="passphrase" class="swal2-input" placeholder="Passphrase">',
                type: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                closeOnClickOutside: false,
                backdrop: true,
                showCancelButton: true,
                confirmButtonClass: "btn-danger",
                confirmButtonText: "Yes, submit this document!",
                cancelButtonText: "No, cancel it!",
                closeOnConfirm: true,
                closeOnCancel: true,
                preConfirm: () => {
                    passphrase = Swal.getPopup().querySelector('#passphrase').value
                }

            }).then(function (confirm) {
                if (!confirm.value) {
                    Swal.fire({
                        allowOutsideClick: false,
                        allowEscapeKey: false,
                        closeOnClickOutside: false,
                        backdrop: true,
                        confirmButtonColor: "#545B62",
                        title: 'Cancelled!',
                        text: 'Your document has not been submitted.',
                        type: 'error',
                        confirmButtonText: 'Ok'
                    });
                    return false;
                }

                var form = $('#formStep1');
                var data = new FormData(document.getElementById('formStep1'));
                let searchParams = new URLSearchParams(window.location.search)
                var id = searchParams.get('Id');
                var type = searchParams.get('Type');
                var template = searchParams.get('Template');

                if ($('#tbName').val().length === 0) {
                    Swal.fire({
                        title: 'Error!',
                        text: 'Unable to Process. Please add a "Name"',
                        type: 'error',
                        confirmButtonColor: "#545B62",
                        confirmButtonText: 'Ok'
                    });
                    return false;
                }

                if ($('#tbSummary').val().length === 0) {
                    Swal.fire({
                        title: 'Error!',
                        text: 'Unable to Process. Please add a "Summary"',
                        type: 'error',
                        confirmButtonColor: "#545B62",
                        confirmButtonText: 'Ok'
                    });
                    return false;
                }

                if ($('#tbAddress').val().length === 0) {
                    Swal.fire({
                        title: 'Error!',
                        text: 'Unable to Process. Please add a "Reward Address"',
                        type: 'error',
                        confirmButtonColor: "#545B62",
                        confirmButtonText: 'Ok'
                    });
                    return false;
                }

                if ($('#tbReward').val().length === 0) {
                    Swal.fire({
                        title: 'Error!',
                        text: 'Unable to Process. Please add a "Reward Amount"',
                        type: 'error',
                        confirmButtonColor: "#545B62",
                        confirmButtonText: 'Ok'
                    });
                    return false;
                }

                data.append('id', id);
                data.append('Type', type);
                data.append('Name', $('#tbName').val());
                data.append('Summary', $('#tbSummary').val());
                data.append('html', $('#archiveDiv').html());
                data.append('isArchive', 1);
                data.append('isMedia', 1);
                data.append('PaymentAddress', $('#tbAddress').val());
                data.append('PaymentAmount', $('#tbReward').val());
                data.append('IsDraft', 1);
                data.append('PaymentDate', $('#EndCycleDate').html());
                data.append('IPFSPID', $('#tbParentIPFSCIDhidden').val());
                data.append('passphrase', passphrase);
                data.append('formData', form.serialize());

                $.ajax({
                    url: '@Url.Action("Submit", "Create", new { Area = "Create" })',
                    type: 'POST',
                    contentType: false,
                    processData: false,
                    data: data,
                    beforeSend: function () {
                        Swal.fire({
                            showConfirmButton: false,
                            allowOutsideClick: false,
                            allowEscapeKey: false,
                            closeOnClickOutside: false,
                            backdrop: true,
                            title: 'Processing Your Document.',
                            html:
                                'Attempting to submit your document to the blockchain.' +
                                '<br><br><b>Estimated Time:10-30 minutes</b><br>' +
                                '<br>Do not leave this page until you receive success or failure message!',

                            didOpen: () => {
                                const content = Swal.getHtmlContainer()
                                const $ = content.querySelector.bind(content)
                                Swal.showLoading()
                            }
                        })
                    },
                    complete: function (data) {
                    }

                }).done(function (result) {
                    swal.close();
                    if (result.success) {
                        var success = result.Success;
                        var summaryName = result.summaryname;
                        var summary = result.summary;
                        var proposalHash = result.proposalhash;
                        var escapedString = '@("@historiasys")';
                        $('#submitArchive').hide();
                        $('#submitArchive').prop('disabled', true);
                        Swal.fire({
                            allowOutsideClick: false,
                            allowEscapeKey: false,
                            closeOnClickOutside: false,
                            confirmButtonColor: "#545B62",
                            backdrop: true,
                            title: 'Success!',
                            html:
                                'Your document has been submitted. Do NOT close the IPFS Window for at least 30 minutes to guarantee your document will be distributed correctly.<br><br><b>Marketing</b><br>For the best chance to get your document passed by the voters, you should market and lobby for it!<br><br>Share on social media:<br><hr><div class= "container"><div class="row justify-content-center"> <div class="col-sm text-center"> <a class="social-link" href = "http://twitter.com/share?text=' + summaryName + ' - ' + summary + '&url=https://historia.network/id/' + proposalHash + ' &hashtags=#historia,#blockchain,' + escapedString + '" target="_blank" ><i class="fa-brands fa-twitter social-icon"></i> X.com</a ></div><div class="col-sm text-center"><a class="social-link" href="https://www.facebook.com/sharer/sharer.php?u=https://historia.network/id/' + proposalHash + '" target="_blank"><i class="fa-brands fa-facebook-f social-icon"></i> Facebook</a></div></div><div class="row justify-content-center"><div class="col-sm text-center"><a class="social-link" href="https://discordapp.com/invite/b3FJPpn" target="_blank"><i class="fa-brands fa-discord social-icon"></i> Discord</a></div><div class="col-sm text-center"><a class="social-link" href="https://t.me/share/url?url=https://historia.network/id/' + proposalHash + '" target="_blank"><i class="fa-brands fa-telegram social-icon"></i> Telegram</a></div></div><div class="row justify-content-center"><div class="col-sm text-center"><a class="social-link" href="https://www.reddit.com/submit?url=https://historia.network/id/' + proposalHash + '" target="_blank"><i class="fa-brands fa-reddit social-icon"></i> Reddit</a></div><div class="col-sm text-center"><a class="social-link" href="mailto:?subject=Check%20out%20this%20link&body=Heres%20the%20link%3A%2https://historia.network/id/' + proposalHash + '"><i class="fa fa-envelope social-icon" aria-hidden="true"></i> Via Email</a></div></div></div>',
                            type: 'success',
                            confirmButtonText: 'Ok'
                        }).then(function () {
                            window.location.href = "/";
                        });

                    }
                    else {
                        Swal.fire({
                            allowOutsideClick: false,
                            allowEscapeKey: false,
                            closeOnClickOutside: false,
                            backdrop: true,
                            confirmButtonColor: "#545B62",
                            title: 'Error!',
                            text: result.error,
                            type: 'error',
                            confirmButtonText: 'Ok'
                        });
                    }
                }).always(function (result) {

                });

                return false;
            });
            return false;
        });

        function generateUUID() { // Public Domain/MIT
            var d = new Date().getTime();
            if (typeof performance !== 'undefined' && typeof performance.now === 'function') {
                d += performance.now(); //use high-precision timer if available
            }
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                var r = (d + Math.random() * 16) % 16 | 0;
                d = Math.floor(d / 16);
                return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
            });
        }

        $(document).ready(function () {



            if (template === "proposal" || template === "news" || template === "wiki") {
                CreateBuilderLoadTemplate(template);
                $('#submitRec').show();
                $('#submitRec').prop('disabled', false);
                $('#submitArchive').hide();
                $('#submitArchive').prop('disabled', true);
                $('#deleteArchiveDraft').hide();
            } else if (type == 4.1) {
                CreateBuilderLoadMedia();
                $('#submitRec').hide();
                $('#saveDraft').hide();
                $('#deleteDraft').hide();
                $('#deleteArchiveDraft').show();
                $('#submitArchive').show();
                $('#submitArchive').prop('disabled', false);
            } else if (type == 5) {
                CreateBuilderLoadArchiveURL();
                $('#submitRec').hide();
                $('#saveDraft').hide();
                $('#deleteDraft').hide();
                $('#deleteArchiveDraft').show();
                $('#submitArchive').show();
                $('#submitArchive').prop('disabled', false);

            } else {
                CreateBuilderLoad();
                $('#submitRec').show();
                $('#submitRec').prop('disabled', false);
                $('#submitArchive').hide();
                $('#submitArchive').prop('disabled', true);
                $('#deleteArchiveDraft').hide();

            }

            $('#tbName').keyup(UpdateProposalNameCnt);
            $('#tbName').keydown(UpdateProposalNameCnt);
            $('#tbSummary').keyup(UpdateProposalSummaryCnt);
            $('#tbSummary').keydown(UpdateProposalSummaryCnt);
            GetNewAddress();

        });

        $('#saveDraft').off().on('click', function (evt) {

            var form = $('#formStep1');
            var html = editor.getHtml();
            var css = editor.getCss(); //get css content of document
            var data = new FormData(document.getElementById('formStep1'));

            let searchParams = new URLSearchParams(window.location.search)
            var id = searchParams.get('Id');
            var type = searchParams.get('Type');

            if ($('#tbName').val().length === 0) {
                Swal.fire({
                    title: 'Error!',
                    text: 'Unable to save draft. Please add a "Name"',
                    type: 'error',
                    confirmButtonColor: "#545B62",
                    confirmButtonText: 'Ok'
                });
                return false;
            }

            data.append('id', id);
            data.append('Type', type);
            data.append('Name', $('#tbName').val());
            data.append('Summary', $('#tbSummary').val());
            data.append('html', html);
            data.append('css', css);
            data.append('PaymentAddress', $('#tbAddress').val());
            data.append('PaymentAmount', $('#tbReward').val());
            data.append('IsDraft', 1);
            //data.append('ParentIPFSCID', $('#tbParentIPFSCID').val());
            data.append('paymentDate', $('#tbPaymentDate').val());
            data.append('formData', form.serialize());


            $.ajax({
                url: '@Url.Action("SaveCreateDraft", "Create", new { Area = "Create" })',
                type: 'POST',
                contentType: false,
                processData: false,
                data: data,
            }).done(function (result) {

                if (result.success) {
                    Swal.fire({
                        title: 'Success!',
                        text: 'You draft has been saved.',
                        type: 'success',
                        confirmButtonColor: "#48B5C4",
                        confirmButtonText: 'Ok'
                    });
                }
                else {
                    Swal.fire({
                        title: 'Error!',
                        text: 'Unable to save draft. Your file is probably too big, otherwise try again later.',
                        type: 'error',
                        confirmButtonColor: "#48B5C4",
                        confirmButtonText: 'Ok'
                    });
                }
            });

            return false;

        });

        $('#deleteDraft').off().on('click', function (evt) {

            let searchParams = new URLSearchParams(window.location.search)
            var id = searchParams.get('Id');


            var form = $('#formStep1');
            var data = new FormData(document.getElementById('formStep1'));
            data.append('id', id);
            data.append('formData', form.serialize());

            Swal.fire({
                title: "Are you sure you want to delete this draft?",
                text: "You can not recover this!",
                type: "warning",
                showCancelButton: true,
                confirmButtonClass: "btn-danger",
                confirmButtonText: "Yes, delete this draft!",
                cancelButtonText: "No, don't delete it!",
                closeOnConfirm: true,
                closeOnCancel: true
            }).then((confirm) => {
                if (confirm.dismiss !== 'cancel') {
                   $.ajax({
                        url: '@Url.Action("DeleteCreateDraft", "Create", new { Area = "Create" })',
                        type: 'POST',
                        contentType: false,
                        processData: false,
                        data: data,
                    }).done(function (result) {

                        if (result.success) {
                            Swal.fire({
                                title: 'Success!',
                                text: 'Your draft has been deleted.',
                                icon: 'success',
                                confirmButtonColor: "#48B5C4",
                                confirmButtonText: 'Ok'
                            }).then(() => {
                                window.location.href = "/Create/Create";
                            });
                        }
                        else {
                            Swal.fire({
                                title: 'Error!',
                                text: 'Unable to delete draft. Please try again later',
                                type: 'error',
                                confirmButtonColor: "#48B5C4",
                                confirmButtonText: 'Ok'
                            });
                        }
                    });
                }
            });

            return false;

        });

        $('#deleteArchiveDraft').off().on('click', function (evt) {


            let searchParams = new URLSearchParams(window.location.search)
            var id = searchParams.get('Id');

            var form = $('#formStep1');
            var data = new FormData(document.getElementById('formStep1'));
            data.append('id', id);
            data.append('formData', form.serialize());

            Swal.fire({
                title: "Are you sure you want to delete this draft?",
                text: "You can not recover this!",
                type: "warning",
                showCancelButton: true,
                confirmButtonClass: "btn-danger",
                confirmButtonText: "Yes, delete this draft!",
                cancelButtonText: "No, don't delete it!",
                closeOnConfirm: true,
                closeOnCancel: true
            }).then((confirm) => {
                if (confirm.dismiss !== 'cancel') {
                   $.ajax({
                        url: '@Url.Action("DeleteArchiveDraft", "Create", new { Area = "Create" })',
                        type: 'POST',
                        contentType: false,
                        processData: false,
                        data: data,
                   }).done(function (result) {

                        if (result.success) {
                            Swal.fire({
                                title: 'Success!',
                                text: 'You draft has been deleted.',
                                type: 'success',
                                confirmButtonColor: "#48B5C4",
                                confirmButtonText: 'Ok'
                            });
                        }
                        else {
                            Swal.fire({
                                title: 'Error!',
                                text: 'Unable to delete draft. Please try again later',
                                type: 'error',
                                confirmButtonColor: "#48B5C4",
                                confirmButtonText: 'Ok'
                            });
                        }
                    });
                    window.location.href = "https://historia.network/";
                }
            });

            return false;

        });



    </script>
}
